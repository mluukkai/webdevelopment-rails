
<!DOCTYPE html>
<html lang="en" class="">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>WebPalvelinohjelmointi2015/viikko6.md at master · mluukkai/WebPalvelinohjelmointi2015 · GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="mluukkai/WebPalvelinohjelmointi2015" name="twitter:title" /><meta content="Contribute to WebPalvelinohjelmointi2015 development by creating an account on GitHub." name="twitter:description" /><meta content="https://avatars3.githubusercontent.com/u/523235?v=3&amp;s=400" name="twitter:image:src" />
      <meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars3.githubusercontent.com/u/523235?v=3&amp;s=400" property="og:image" /><meta content="mluukkai/WebPalvelinohjelmointi2015" property="og:title" /><meta content="https://github.com/mluukkai/WebPalvelinohjelmointi2015" property="og:url" /><meta content="Contribute to WebPalvelinohjelmointi2015 development by creating an account on GitHub." property="og:description" />
      <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">
    <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">
    <link rel="assets" href="https://assets-cdn.github.com/">
    
    <meta name="pjax-timeout" content="1000">
    

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient>
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="6ADC83C8:471C:14DCAB3:555B1CCC" name="octolytics-dimension-request_id" />
    
    <meta content="Rails, view, blob#show" name="analytics-event" />
    <meta class="js-ga-set" name="dimension1" content="Logged Out">
    <meta class="js-ga-set" name="dimension2" content="Header v3">
    <meta name="is-dotcom" content="true">
      <meta name="hostname" content="github.com">
    <meta name="user-login" content="">

    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param" />
<meta content="03Sc5RgX6VnJBO64TVlUdetLQTjUiQmqCo7sSnUHkzqStkKx7sTS6g/49HHtApQcOVDVn4MgB5aPxoN/P3kaxg==" name="csrf-token" />

    <link href="https://assets-cdn.github.com/assets/github/index-d80e093fe7c48ff920ce83dfd2ad7c02806722220d164b49101ed783098ea618.css" media="all" rel="stylesheet" />
    <link href="https://assets-cdn.github.com/assets/github2/index-99a58ea750b0547d1266460cd4ade0c2c81ed8c524cbba4ea5e3b37e18daec79.css" media="all" rel="stylesheet" />
    
    


    <meta http-equiv="x-pjax-version" content="7bc30b38b669884142fe7da73f3839dd">

      
  <meta name="description" content="Contribute to WebPalvelinohjelmointi2015 development by creating an account on GitHub.">
  <meta name="go-import" content="github.com/mluukkai/WebPalvelinohjelmointi2015 git https://github.com/mluukkai/WebPalvelinohjelmointi2015.git">

  <meta content="523235" name="octolytics-dimension-user_id" /><meta content="mluukkai" name="octolytics-dimension-user_login" /><meta content="28270933" name="octolytics-dimension-repository_id" /><meta content="mluukkai/WebPalvelinohjelmointi2015" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="28270933" name="octolytics-dimension-repository_network_root_id" /><meta content="mluukkai/WebPalvelinohjelmointi2015" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/commits/master.atom" rel="alternate" title="Recent Commits to WebPalvelinohjelmointi2015:master" type="application/atom+xml">

  </head>


  <body class="logged_out  env-production linux vis-public page-blob">
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      


        
        <div class="header header-logged-out" role="banner">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions" role="navigation">
        <a class="btn btn-primary" href="/join" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
      <a class="btn" href="/login?return_to=%2Fmluukkai%2FWebPalvelinohjelmointi2015%2Fblob%2Fmaster%2Fweb%2Fviikko6.md" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
    </div>

    <div class="site-search repo-scope js-site-search" role="search">
      <form accept-charset="UTF-8" action="/mluukkai/WebPalvelinohjelmointi2015/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/mluukkai/WebPalvelinohjelmointi2015/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
  <label class="js-chromeless-input-container form-control">
    <div class="scope-badge">This repository</div>
    <input type="text"
      class="js-site-search-focus js-site-search-field is-clearable chromeless-input"
      data-hotkey="s"
      name="q"
      placeholder="Search"
      data-global-scope-placeholder="Search GitHub"
      data-repo-scope-placeholder="Search"
      tabindex="1"
      autocapitalize="off">
  </label>
</form>
    </div>

      <ul class="header-nav left" role="navigation">
          <li class="header-nav-item">
            <a class="header-nav-link" href="/explore" data-ga-click="(Logged out) Header, go to explore, text:explore">Explore</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/features" data-ga-click="(Logged out) Header, go to features, text:features">Features</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://enterprise.github.com/" data-ga-click="(Logged out) Header, go to enterprise, text:enterprise">Enterprise</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/blog" data-ga-click="(Logged out) Header, go to blog, text:blog">Blog</a>
          </li>
      </ul>

  </div>
</div>



      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">

  <li>
      <a href="/login?return_to=%2Fmluukkai%2FWebPalvelinohjelmointi2015"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to watch a repository" rel="nofollow">
    <span class="octicon octicon-eye"></span>
    Watch
  </a>
  <a class="social-count" href="/mluukkai/WebPalvelinohjelmointi2015/watchers">
    8
  </a>

  </li>

  <li>
      <a href="/login?return_to=%2Fmluukkai%2FWebPalvelinohjelmointi2015"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to star a repository" rel="nofollow">
    <span class="octicon octicon-star"></span>
    Star
  </a>

    <a class="social-count js-social-count" href="/mluukkai/WebPalvelinohjelmointi2015/stargazers">
      6
    </a>

  </li>

    <li>
      <a href="/login?return_to=%2Fmluukkai%2FWebPalvelinohjelmointi2015"
        class="btn btn-sm btn-with-count tooltipped tooltipped-n"
        aria-label="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-repo-forked"></span>
        Fork
      </a>
      <a href="/mluukkai/WebPalvelinohjelmointi2015/network" class="social-count">
        17
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="/mluukkai" class="url fn" itemprop="url" rel="author"><span itemprop="title">mluukkai</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="/mluukkai/WebPalvelinohjelmointi2015" class="js-current-repository" data-pjax="#js-repo-pjax-container">WebPalvelinohjelmointi2015</a></strong>

          <span class="page-context-loader">
            <img alt="" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline  ">
        <div class="repository-sidebar clearfix">
            
<nav class="sunken-menu repo-nav js-repo-nav js-sidenav-container-pjax js-octicon-loaders"
     role="navigation"
     data-pjax="#js-repo-pjax-container"
     data-issue-count-url="/mluukkai/WebPalvelinohjelmointi2015/issues/counts">
  <ul class="sunken-menu-group">
    <li class="tooltipped tooltipped-w" aria-label="Code">
      <a href="/mluukkai/WebPalvelinohjelmointi2015" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /mluukkai/WebPalvelinohjelmointi2015">
        <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Issues">
        <a href="/mluukkai/WebPalvelinohjelmointi2015/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /mluukkai/WebPalvelinohjelmointi2015/issues">
          <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
          <span class="js-issue-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>      </li>

    <li class="tooltipped tooltipped-w" aria-label="Pull requests">
      <a href="/mluukkai/WebPalvelinohjelmointi2015/pulls" aria-label="Pull requests" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g p" data-selected-links="repo_pulls /mluukkai/WebPalvelinohjelmointi2015/pulls">
          <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull requests</span>
          <span class="js-pull-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Wiki">
        <a href="/mluukkai/WebPalvelinohjelmointi2015/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g w" data-selected-links="repo_wiki /mluukkai/WebPalvelinohjelmointi2015/wiki">
          <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>      </li>
  </ul>
  <div class="sunken-menu-separator"></div>
  <ul class="sunken-menu-group">

    <li class="tooltipped tooltipped-w" aria-label="Pulse">
      <a href="/mluukkai/WebPalvelinohjelmointi2015/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-selected-links="pulse /mluukkai/WebPalvelinohjelmointi2015/pulse">
        <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

    <li class="tooltipped tooltipped-w" aria-label="Graphs">
      <a href="/mluukkai/WebPalvelinohjelmointi2015/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-selected-links="repo_graphs repo_contributors /mluukkai/WebPalvelinohjelmointi2015/graphs">
        <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>
  </ul>


</nav>

              <div class="only-with-full-nav">
                  
<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/mluukkai/WebPalvelinohjelmointi2015.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/mluukkai/WebPalvelinohjelmointi2015" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>



<p class="clone-options">You can clone with
  <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a> or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>




                <a href="/mluukkai/WebPalvelinohjelmointi2015/archive/master.zip"
                   class="btn btn-sm sidebar-button"
                   aria-label="Download the contents of mluukkai/WebPalvelinohjelmointi2015 as a zip file"
                   title="Download the contents of mluukkai/WebPalvelinohjelmointi2015 as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>

          

<a href="/mluukkai/WebPalvelinohjelmointi2015/blob/7c0a324f2ab4a2238dc3465941374945f50c5210/web/viikko6.md" class="hidden js-permalink-shortcut" data-hotkey="y">Permalink</a>

<!-- blob contrib key: blob_contributors:v21:0bec41e3694f1e72e00e8a763ee110dd -->

<div class="file-navigation js-zeroclipboard-container">
  
<div class="select-menu js-menu-container js-select-menu left">
  <span class="btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    title="master"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open selected"
               href="/mluukkai/WebPalvelinohjelmointi2015/blob/master/web/viikko6.md"
               data-name="master"
               data-skip-pjax="true"
               rel="nofollow">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <span class="select-menu-item-text css-truncate-target" title="master">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>

  <div class="btn-group right">
    <a href="/mluukkai/WebPalvelinohjelmointi2015/find/master"
          class="js-show-file-finder btn btn-sm empty-icon tooltipped tooltipped-s"
          data-pjax
          data-hotkey="t"
          aria-label="Quickly jump between files">
      <span class="octicon octicon-list-unordered"></span>
    </a>
    <button aria-label="Copy file path to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
  </div>

  <div class="breadcrumb js-zeroclipboard-target">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/mluukkai/WebPalvelinohjelmointi2015" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">WebPalvelinohjelmointi2015</span></a></span></span><span class="separator">/</span><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/mluukkai/WebPalvelinohjelmointi2015/tree/master/web" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">web</span></a></span><span class="separator">/</span><strong class="final-path">viikko6.md</strong>
  </div>
</div>


  <div class="commit file-history-tease">
    <div class="file-history-tease-header">
        <img alt="@mluukkai" class="avatar" data-user="523235" height="24" src="https://avatars0.githubusercontent.com/u/523235?v=3&amp;s=48" width="24" />
        <span class="author"><a href="/mluukkai" rel="author">mluukkai</a></span>
        <time datetime="2015-02-20T07:48:16Z" is="relative-time">Feb 20, 2015</time>
        <div class="commit-title">
            <a href="/mluukkai/WebPalvelinohjelmointi2015/commit/a5e1b50ce468d54e5bec81bf12b831855c03cc74" class="message" data-pjax="true" title="poistettu rikkinäinen linkki">poistettu rikkinäinen linkki</a>
        </div>
    </div>

    <div class="participation">
      <p class="quickstat">
        <a href="#blob_contributors_box" rel="facebox">
          <strong>2</strong>
           contributors
        </a>
      </p>
          <a class="avatar-link tooltipped tooltipped-s" aria-label="mluukkai" href="/mluukkai/WebPalvelinohjelmointi2015/commits/master/web/viikko6.md?author=mluukkai"><img alt="@mluukkai" class="avatar" data-user="523235" height="20" src="https://avatars2.githubusercontent.com/u/523235?v=3&amp;s=40" width="20" /> </a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="JiiHu" href="/mluukkai/WebPalvelinohjelmointi2015/commits/master/web/viikko6.md?author=JiiHu"><img alt="@JiiHu" class="avatar" data-user="8706653" height="20" src="https://avatars2.githubusercontent.com/u/8706653?v=3&amp;s=40" width="20" /> </a>


    </div>
    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list">
          <li class="facebox-user-list-item">
            <img alt="@mluukkai" data-user="523235" height="24" src="https://avatars0.githubusercontent.com/u/523235?v=3&amp;s=48" width="24" />
            <a href="/mluukkai">mluukkai</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="@JiiHu" data-user="8706653" height="24" src="https://avatars0.githubusercontent.com/u/8706653?v=3&amp;s=48" width="24" />
            <a href="/JiiHu">JiiHu</a>
          </li>
      </ul>
    </div>
  </div>

<div class="file">
  <div class="file-header">
    <div class="file-actions">

      <div class="btn-group">
        <a href="/mluukkai/WebPalvelinohjelmointi2015/raw/master/web/viikko6.md" class="btn btn-sm " id="raw-url">Raw</a>
          <a href="/mluukkai/WebPalvelinohjelmointi2015/blame/master/web/viikko6.md" class="btn btn-sm js-update-url-with-hash">Blame</a>
        <a href="/mluukkai/WebPalvelinohjelmointi2015/commits/master/web/viikko6.md" class="btn btn-sm " rel="nofollow">History</a>
      </div>


          <button type="button" class="octicon-btn disabled tooltipped tooltipped-n" aria-label="You must be signed in to make or propose changes">
            <span class="octicon octicon-pencil"></span>
          </button>

        <button type="button" class="octicon-btn octicon-btn-danger disabled tooltipped tooltipped-n" aria-label="You must be signed in to make or propose changes">
          <span class="octicon octicon-trashcan"></span>
        </button>
    </div>

    <div class="file-info">
        1027 lines (760 sloc)
        <span class="file-info-divider"></span>
      44.892 kb
    </div>
  </div>
    <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><p>You will continue to develop your application from the point you arrived at the end of week 5. The material that follows comes with the assumption that you have done all the exercises of the previous week. In case you have not done all of them, you can take the sample answer to the previous week <a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/tree/master/malliv/viikko5">from the course repository</a>. If you already got most of the previous week exercises done, it might be easier if you complement your own answer with the help of the material.</p>

<p>If you start working this week on the base of last week sample answer, copy the folder from the course repository (assuming you have alrady cloned it) and make a new repository of the folder with the application.</p>

<p><strong>Attention:</strong> some Mac users have found problems with the pg-gem which Heroku needs. Gems are not needed locally and we defined to set them only in the production environment. If you have problems, you can set gems by adding the following expression to <code>bundle install</code>:</p>

<pre><code>bundle install --without production
</code></pre>

<p>This setting will be remembered later on, so a simple `bundle install` will be enough if you want to set up new dependences.</p>

<h2>
<a id="user-content-testeistä" class="anchor" href="#testeist%C3%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>About Tests</h2>

<p>A part of this week exercises may break some of the tests from the previous weeks. You can mark that you have done the exercises even though tests are broken. It's up to you whether you want to fix them or not.</p>

<h2>
<a id="user-content-bootstrap" class="anchor" href="#bootstrap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bootstrap</h2>

<p>You haven't been paying too much attention to the outlook of your application so far. The modern trend is that the HTML code only defines the information on the pages, whereas their outlook is defined in the various different CSS files.</p>

<p>We use <em>classes</em> <em>IDs</em> to define elements in HTML, so that the styles defined in the appropriate files go to the right spots on the page.</p>

<p>Already few weeks ago, you defined that the application layout navigation bar is located in the div element, which is given the class "navibar":</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>navibar<span class="pl-pds">"</span></span>&gt;
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>breweries<span class="pl-pds">'</span></span>, breweries_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>beers<span class="pl-pds">'</span></span>, beers_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>styles<span class="pl-pds">'</span></span>, styles_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>ratings<span class="pl-pds">'</span></span>, ratings_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, users_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>clubs<span class="pl-pds">'</span></span>, beer_clubs_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>places<span class="pl-pds">'</span></span>, places_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  |
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> <span class="pl-k">not</span> current_user.nil? </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to current_user.username, current_user </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>rate a beer<span class="pl-pds">'</span></span>, new_rating_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>join a club<span class="pl-pds">'</span></span>, new_membership_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signout<span class="pl-pds">'</span></span>, signout_path, <span class="pl-c1">method:</span> <span class="pl-c1">:delete</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">else</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signin<span class="pl-pds">'</span></span>, signin_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signup<span class="pl-pds">'</span></span>, signup_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>

<p>In week 2, we defined a style for the navigation bar by adding the following features to the file application.css, in app/assets/stylesheats/:</p>

<div class="highlight highlight-css"><pre><span class="pl-e">.navibar</span> {
    <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">10<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">background</span></span>: <span class="pl-c1">#EFEFEF</span>;
}</pre></div>

<p>A developer could design the whole page outlook using a CSS, having the appropriate eye and skills.</p>

<p>It is not even necessary to reinvent the wheel when it comes to the page design. Bootstrap (the old Twitter Bootstrap) <a href="http://getbootstrap.com/">http://getbootstrap.com/</a> is a "framework", which contains a huge amount of CSS files and javascript intended for designing web pages. In fact, Bootstrap has found favour with Web page designers.</p>

<p>Get started with bootstrapping your application with the gem <a href="https://github.com/twbs/bootstrap-sass">https://github.com/twbs/bootstrap-sass</a>. Add the following to your Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>bootstrap-sass<span class="pl-pds">'</span></span>
group <span class="pl-c1">:development</span> <span class="pl-k">do</span>
  <span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>rails_layout<span class="pl-pds">'</span></span>
<span class="pl-k">end</span></pre></div>

<p>Set up the gems by running <code>bundle install</code>.</p>

<p>Next thing to do is generating the files needed with Bootstrap.
<strong>Write down the code to generate the navigation bar of your application before you do it, in any case.</strong> Then generate the bootstrap files; do it with the command below (which will overwrite the file application.html.erb and others)</p>

<pre><code>rails generate layout:install bootstrap3 --force
</code></pre>

<p>Restart Rails. You will notice a small change in the fonts already when you start your application with the browser. The navigation bar has also disappeared.</p>

<p><strong>ATTENTION:</strong> if the file applicationc.css was left in the folder app/assets/stylesheets, you may have to delete it because the script above has created the file<em>application.css.scss</em> which replaces it.</p>

<p>The command that you have executed before has created the files <em>navigation.html.erb</em> and <em>_navigation_links.html.erb</em>. The two are located in the folder app/views/layout and take care of the navigation bar.</em></p>

<p>As you may guess, <em>_navigation_links.html.erb</em> should contain the navigation bar links. Each link has to be placed in a li tag. Add the following to the file:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>breweries<span class="pl-pds">'</span></span>, breweries_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>beers<span class="pl-pds">'</span></span>, beers_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>styles<span class="pl-pds">'</span></span>, styles_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>ratings<span class="pl-pds">'</span></span>, ratings_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, users_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>clubs<span class="pl-pds">'</span></span>, beer_clubs_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
&lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>places<span class="pl-pds">'</span></span>, places_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> <span class="pl-k">not</span> current_user.nil? </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to current_user.username, current_user </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>rate a beer<span class="pl-pds">'</span></span>, new_rating_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>join a club<span class="pl-pds">'</span></span>, new_membership_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signout<span class="pl-pds">'</span></span>, signout_path, <span class="pl-c1">method:</span> <span class="pl-c1">:delete</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">else</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signin<span class="pl-pds">'</span></span>, signin_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
    &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>signup<span class="pl-pds">'</span></span>, signup_path </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>Not only Bootstrap easily helps you to create a navigation bar which will stay on the top of the page, Bootstrap's grid will allow you to devide the page in different parts, see  <a href="http://getbootstrap.com/css/#grid">http://getbootstrap.com/css/#grid</a></p>

<p>Change your application layout, acting on the part of the application.html.erb file which renders the page background:</p>

<div class="highlight highlight-erb"><pre>  &lt;<span class="pl-ent">body</span>&gt;
    &lt;<span class="pl-ent">header</span>&gt;
      <span class="pl-pse">&lt;%=</span><span class="pl-s1"> render <span class="pl-s"><span class="pl-pds">'</span>layouts/navigation<span class="pl-pds">'</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    &lt;/<span class="pl-ent">header</span>&gt;

    &lt;<span class="pl-ent">main</span> <span class="pl-e">role</span>=<span class="pl-s"><span class="pl-pds">"</span>main<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>.container<span class="pl-pds">"</span></span>&gt;
      <span class="pl-pse">&lt;%=</span><span class="pl-s1"> render <span class="pl-s"><span class="pl-pds">'</span>layouts/messages<span class="pl-pds">'</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>

      &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>row<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-md-8<span class="pl-pds">"</span></span>&gt;
          <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-k">yield</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
        &lt;/<span class="pl-ent">div</span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-md-4<span class="pl-pds">"</span></span>&gt;
          &lt;<span class="pl-ent">img</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.cs.helsinki.fi/u/mluukkai/wadror/pint.jpg<span class="pl-pds">"</span></span> <span class="pl-e">width</span>=<span class="pl-s"><span class="pl-pds">"</span>200<span class="pl-pds">"</span></span>&gt;
        &lt;/<span class="pl-ent">div</span>&gt;
      &lt;/<span class="pl-ent">div</span>&gt;

    &lt;/<span class="pl-ent">main</span>&gt;
  &lt;/<span class="pl-ent">body</span>&gt;</pre></div>

<p>So you first put one line in the bootstrap container, and then you devide it in two columns: one is wide eight, and the other one is four and will contain a picture.</p>

<p>The page background is good now, and you can use Bootstrap styles and components on your pages.</p>

<p>The navigation was already defined with the help of the <em>navbar</em> component, see <a href="http://getbootstrap.com/components/#navbar">http://getbootstrap.com/components/#navbar</a>.</p>

<p>Next, you should modify the tables used on the page. You see from Bootstrap's page <a href="http://getbootstrap.com/css/#tables">http://getbootstrap.com/css/#tables</a> that you can use Bootstrap's default layout by adding the class <code>table</code> to the table HTML code, as it follows below:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">table</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>table<span class="pl-pds">"</span></span>&gt;
  ...
&lt;/<span class="pl-ent">table</span>&gt;</pre></div>

<p>Try to add the class definition on the beers page and see what it looks like. It will already look much more professional. You want to add the class <code>table-hover</code> too. Thanks to this, if you move the mouse pointer on a line, this will become bold. The table class definition will be</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">table</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>table table-hover<span class="pl-pds">"</span></span>&gt;
  ...
&lt;/<span class="pl-ent">table</span>&gt;</pre></div>

<blockquote>
<h2>
<a id="user-content-tehtävä-1" class="anchor" href="#teht%C3%A4v%C3%A4-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävä 1</h2>

<p>Change at least some of the application tables to use the Bootstrap styles.</p>
</blockquote>

<p>Bootstrap also provides you with button styles <a href="http://getbootstrap.com/css/#buttons">http://getbootstrap.com/css/#buttons</a></p>

<p>Use the blue button which is defined by the class pair <code>btn btn-primary</code>. Below an example where the class has been added a button for beer rating:</p>

<div class="highlight highlight-erb"><pre>  &lt;<span class="pl-ent">h4</span>&gt;give a rating:&lt;/<span class="pl-ent">h4</span>&gt;

  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> form_for(<span class="pl-smi">@rating</span>) <span class="pl-k">do </span>|<span class="pl-smi">f</span>| </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> f.hidden_field <span class="pl-c1">:beer_id</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    score: <span class="pl-pse">&lt;%=</span><span class="pl-s1"> f.number_field <span class="pl-c1">:score</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> f.submit <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>The class can also be added to links which should look like buttons:</p>

<div class="highlight highlight-erb"><pre><span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>New Beer<span class="pl-pds">'</span></span>, new_beer_path, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">'</span>btn btn-primary<span class="pl-pds">'</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<blockquote>
<h2>
<a id="user-content-tehtävä-2" class="anchor" href="#teht%C3%A4v%C3%A4-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävä 2</h2>

<p>Add styles to your application for at least a couple of button and links. You may want to choose the style <code>btn btn-danger</code> for the delete operation.</p>

<h2>
<a id="user-content-tehtävä-3" class="anchor" href="#teht%C3%A4v%C3%A4-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercise 3</h2>

<p>Change the navigation bar so that when users signs in, their signed-in user actions are listed in the menu bar. They should be contained in a drop down menu like the picture below.</p>

<p>You find guidelines from the document <a href="http://getbootstrap.com/components/#nav-dropdowns">http://getbootstrap.com/components/#nav-dropdowns</a></p>
</blockquote>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-3.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-3.png" alt="kuva" style="max-width:100%;"></a></p>

<blockquote>
<h2>
<a id="user-content-tehtävä-4" class="anchor" href="#teht%C3%A4v%C3%A4-4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercise 4</h2>

<p>Make your Web site fashonable using some Bootstrap component. You can cross the exercise if you spend at least 15 minutes to improve the outlook of your pages. You also pass it if you use Bootstrap's styles to change the left-over application tables and buttons.</p>
</blockquote>

<h2>
<a id="user-content-scopet" class="anchor" href="#scopet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Scopet</h2>

<p>Some of the breweries have expired and you want to distinguish them from the active breweries in the list. Add a boolean column to the brewery database that tells whether they are active. Create a migration:</p>

<pre><code>rails g migration AddActivityToBrewery active:boolean
</code></pre>

<p>Attention: because the migration name starts with the word Add and ends in the object name, that is Brewery, and because it contains the information about the column to be added, the migration code is generated automatically.</p>

<p>Execute the migration; then go to your console to mark by hand all the breweries in the database and make them active:</p>

<div class="highlight highlight-ruby"><pre>irb(main):<span class="pl-c1">020</span>:<span class="pl-c1">0</span><span class="pl-k">&gt;</span> <span class="pl-c1">Brewery</span>.all.each{ |<span class="pl-smi">b</span>| b.active<span class="pl-k">=</span><span class="pl-c1">true</span>; b.save }</pre></div>

<p>Go and create a new brewery so that your database will contain an inactive brewery too.</p>

<p>Then change the brewery page so that next to the brewery name, it tells if the brewery is inactive:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">h2</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@brewery</span>.name </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> <span class="pl-k">not</span> <span class="pl-smi">@brewery</span>.active  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
      &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>label label-info<span class="pl-pds">"</span></span>&gt;retired&lt;/<span class="pl-ent">span</span>&gt;
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">p</span>&gt;
  &lt;<span class="pl-ent">em</span>&gt;Established year:&lt;/<span class="pl-ent">em</span>&gt;
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@brewery</span>.year </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">p</span>&gt;

&lt;<span class="pl-ent">p</span>&gt;Number of beers <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@brewery</span>.beers.count</span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;

&lt;<span class="pl-ent">ul</span>&gt;
 <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-smi">@brewery</span>.beers.each <span class="pl-k">do </span>|<span class="pl-smi">beer</span>| </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
   &lt;<span class="pl-ent">li</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to beer.name, beer </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">li</span>&gt;
 <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">ul</span>&gt;

<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> <span class="pl-smi">@brewery</span>.ratings.empty? </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    &lt;<span class="pl-ent">p</span>&gt;beers of the brewery have not yet been rated! &lt;/<span class="pl-ent">p</span>&gt;
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">else</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    &lt;<span class="pl-ent">p</span>&gt;Has <span class="pl-pse">&lt;%=</span><span class="pl-s1"> pluralize(<span class="pl-smi">@brewery</span>.ratings.count,<span class="pl-s"><span class="pl-pds">'</span>rating<span class="pl-pds">'</span></span>) </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>, average <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@brewery</span>.average_rating </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>

<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> current_user </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>Edit<span class="pl-pds">'</span></span>, edit_brewery_path(<span class="pl-smi">@brewery</span>), <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span>  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>Destroy<span class="pl-pds">'</span></span>, <span class="pl-smi">@brewery</span>, <span class="pl-c1">method:</span> <span class="pl-c1">:delete</span>, <span class="pl-c1">data:</span> { <span class="pl-c1">confirm:</span> <span class="pl-s"><span class="pl-pds">'</span>Are you sure?<span class="pl-pds">'</span></span> }, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-danger<span class="pl-pds">"</span></span>  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>It makes sense to allow setting up the brewery activity from the form to create and edit them. Add an activity setting checkbox to views/breweries/_form-html.erb:</p>

<div class="highlight highlight-erb"><pre>  &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>field<span class="pl-pds">"</span></span>&gt;
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> f.label <span class="pl-c1">:active</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
    <span class="pl-pse">&lt;%=</span><span class="pl-s1"> f.check_box <span class="pl-c1">:active</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  &lt;/<span class="pl-ent">div</span>&gt;</pre></div>

<p>Try this out. You will see that changing the activity does not work, however.</p>

<p>The problem is that the attribute <code>active</code> is not among the attributes which allow for mass assignment.</p>

<p>Inspect the brewery controller a bit. Creating breweries and editing their information both require the information is retrived through the method <code>brewery_params</code>:</p>

<div class="highlight highlight-ruby"><pre>
  <span class="pl-k">def</span> <span class="pl-en">create</span>
    <span class="pl-smi">@brewery</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.<span class="pl-k">new</span>(brewery_params)

    <span class="pl-c"># ...</span>
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">update</span>
    <span class="pl-c"># ...</span>
    <span class="pl-k">if</span> <span class="pl-smi">@brewery</span>.update(brewery_params)
    <span class="pl-c"># ...</span>
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">brewery_params</span>
    params.<span class="pl-k">require</span>(<span class="pl-c1">:brewery</span>).permit(<span class="pl-c1">:name</span>, <span class="pl-c1">:year</span>)
  <span class="pl-k">end</span></pre></div>

<p>As you've seen in <a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/blob/master/web/viikko2.md#reittauksen-talletus">week 2</a> every attribute intended for mass assignment has to be explicitely allowed through the method <code>permit</code>. Change the method <code>brewery_params</code> as it follows:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">brewery_params</span>
    params.<span class="pl-k">require</span>(<span class="pl-c1">:brewery</span>).permit(<span class="pl-c1">:name</span>, <span class="pl-c1">:year</span>, <span class="pl-c1">:active</span>)
  <span class="pl-k">end</span></pre></div>

<p>You want to show the active and inactive breweries separately in the breweries list. A straight-forward solution is saving the active and inactive ones with the controller using own values:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">index</span>
    <span class="pl-smi">@active_breweries</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.where(<span class="pl-c1">active:</span><span class="pl-c1">true</span>)
    <span class="pl-smi">@retired_breweries</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.where(<span class="pl-c1">active:</span>[<span class="pl-c1">nil</span>, <span class="pl-c1">false</span>])
  <span class="pl-k">end</span></pre></div>

<p>The value <code>active</code> of the field can either be explicitally set as <code>false</code> or <code>nil</code>; we had to add both options to the last <code>where</code> sentence so that they both refer to inactive breweries.</p>

<p>Copy paste the table in the view twice, for the active and inactive ones:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">h1</span>&gt;Breweries&lt;/<span class="pl-ent">h1</span>&gt;

&lt;<span class="pl-ent">h2</span>&gt;Active&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">p</span>&gt; Number of active breweries: <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@active_breweries</span>.count </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;

&lt;<span class="pl-ent">table</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>table table-hover<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">thead</span>&gt;
    &lt;<span class="pl-ent">tr</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Name&lt;/<span class="pl-ent">th</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Year&lt;/<span class="pl-ent">th</span>&gt;
    &lt;/<span class="pl-ent">tr</span>&gt;
  &lt;/<span class="pl-ent">thead</span>&gt;

  &lt;<span class="pl-ent">tbody</span>&gt;
    <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-smi">@active_breweries</span>.each <span class="pl-k">do </span>|<span class="pl-smi">brewery</span>| </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
      &lt;<span class="pl-ent">tr</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to brewery.name, brewery </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> brewery.year </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;&lt;/<span class="pl-ent">td</span>&gt;
      &lt;/<span class="pl-ent">tr</span>&gt;
    <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  &lt;/<span class="pl-ent">tbody</span>&gt;
&lt;/<span class="pl-ent">table</span>&gt;

&lt;<span class="pl-ent">h2</span>&gt;Retired&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">p</span>&gt; Number of retired breweries: <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@retired_breweries</span>.count </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;

&lt;<span class="pl-ent">table</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>table table-hover<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">thead</span>&gt;
  &lt;<span class="pl-ent">tr</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Name&lt;/<span class="pl-ent">th</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Year&lt;/<span class="pl-ent">th</span>&gt;
  &lt;/<span class="pl-ent">tr</span>&gt;
  &lt;/<span class="pl-ent">thead</span>&gt;

  &lt;<span class="pl-ent">tbody</span>&gt;
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-smi">@retired_breweries</span>.each <span class="pl-k">do </span>|<span class="pl-smi">brewery</span>| </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
      &lt;<span class="pl-ent">tr</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to brewery.name, brewery </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> brewery.year </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;&lt;/<span class="pl-ent">td</span>&gt;
      &lt;/<span class="pl-ent">tr</span>&gt;
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  &lt;/<span class="pl-ent">tbody</span>&gt;
&lt;/<span class="pl-ent">table</span>&gt;

&lt;<span class="pl-ent">br</span>&gt;

<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>New Brewery<span class="pl-pds">'</span></span>, new_brewery_path, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span>  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>The solution works, but there are a couple of options which are even better. Start with the controller first.</p>

<p>The controllers requires a list of both active and inactive breweries. The controller also tells how the two lists are retrived from the database.</p>

<p>You could polish the controller by making so that the class <code>Brewery</code> provides a better interface to find the breweries list. ActiveRecord provides a nice solution for this, scope, see <a href="http://guides.rubyonrails.org/active_record_querying.html#scopes">http://guides.rubyonrails.org/active_record_querying.html#scopes</a></p>

<p>Define two scopes for the breweries, active and inactive:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Brewery<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  <span class="pl-k">include</span> <span class="pl-c1">RatingAverage</span>

  validates <span class="pl-c1">:name</span>, <span class="pl-c1">presence:</span> <span class="pl-c1">true</span>
  validates <span class="pl-c1">:year</span>, <span class="pl-c1">numericality:</span> { <span class="pl-c1">less_than_or_equal_to:</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span>(_) { <span class="pl-c1">Time</span>.now.year} }

  scope <span class="pl-c1">:active</span>, <span class="pl-k">-</span><span class="pl-k">&gt;</span> { where <span class="pl-c1">active:</span><span class="pl-c1">true</span> }
  scope <span class="pl-c1">:retired</span>, <span class="pl-k">-</span><span class="pl-k">&gt;</span> { where <span class="pl-c1">active:</span>[<span class="pl-c1">nil</span>,<span class="pl-c1">false</span>] }

  has_many <span class="pl-c1">:beers</span>, <span class="pl-c1">:dependent</span> =&gt; <span class="pl-c1">:destroy</span>
  has_many <span class="pl-c1">:ratings</span>, <span class="pl-c1">:through</span> =&gt; <span class="pl-c1">:beers</span>
<span class="pl-k">end</span></pre></div>

<p>The scope defines a class method which returns all the beers returned according to the search against the scope.</p>

<p>Now the class <code>Brewery</code> provides you not only with all the breweries but also a nice interface with the active the inactive ones:</p>

<pre><code>Brewery.all      # all breweries
Brewery.active   # the active ones
Brewery.retired  # the inactive ones
</code></pre>

<p>The controller will be more elegant at this point:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">index</span>
    <span class="pl-smi">@active_breweries</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.active
    <span class="pl-smi">@retired_breweries</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.retired
  <span class="pl-k">end</span></pre></div>

<p>The solution is better not only for the clarity but also in terms of responsibility assignment of the objects. It is not too good to let me controller tell <em>how</em> active and retired breweries have to be retrived from the database. Instead, it is natural to make a model responsible for it, because models role is to act as an abstract level between the rest of the application and the database.</p>

<h2>
<a id="user-content-partiaalit" class="anchor" href="#partiaalit" aria-hidden="true"><span class="octicon octicon-link"></span></a>Partiaalit</h2>

<p>Polish the brewery list view template next. The template uses now the same table which is copied twice in a row. Divide the table into <strong>partials</strong>, eli näyttötemplateen upotettavaksi tarkoitetuksi näyttötemplaten palaksi, ks. <a href="http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials">http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials</a>.</p>

<p>Give a name to a partial and call it views/breweries/_list.html.erb (notice that partials names always start with underscore!). The contents are like it follows below:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">table</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>table table-hover<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">thead</span>&gt;
  &lt;<span class="pl-ent">tr</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Name&lt;/<span class="pl-ent">th</span>&gt;
    &lt;<span class="pl-ent">th</span>&gt;Year&lt;/<span class="pl-ent">th</span>&gt;
  &lt;/<span class="pl-ent">tr</span>&gt;
  &lt;/<span class="pl-ent">thead</span>&gt;

  &lt;<span class="pl-ent">tbody</span>&gt;
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> breweries.each <span class="pl-k">do </span>|<span class="pl-smi">brewery</span>| </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
      &lt;<span class="pl-ent">tr</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to brewery.name, brewery </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> brewery.year </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">td</span>&gt;
        &lt;<span class="pl-ent">td</span>&gt;&lt;/<span class="pl-ent">td</span>&gt;
      &lt;/<span class="pl-ent">tr</span>&gt;
  <span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  &lt;/<span class="pl-ent">tbody</span>&gt;
&lt;/<span class="pl-ent">table</span>&gt;</pre></div>

<p>A partial called <code>breweries</code> refers now to the list of the breweries which have to be placed into a table.</p>

<p>The template which renders the breweries only <em>renders the partial</em> and sends as parameter the brewery list to render:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">p</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>notice<span class="pl-pds">"</span></span>&gt;<span class="pl-pse">&lt;%=</span><span class="pl-s1"> notice </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>&lt;/<span class="pl-ent">p</span>&gt;

&lt;<span class="pl-ent">h1</span>&gt;Breweries&lt;/<span class="pl-ent">h1</span>&gt;

&lt;<span class="pl-ent">h2</span>&gt;Active&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">p</span>&gt; Number of active breweries: <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@active_breweries</span>.count </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;

<span class="pl-pse">&lt;%=</span><span class="pl-s1"> render <span class="pl-s"><span class="pl-pds">'</span>list<span class="pl-pds">'</span></span>, <span class="pl-c1">breweries:</span> <span class="pl-smi">@active_breweries</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>

&lt;<span class="pl-ent">h2</span>&gt;Retired&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">p</span>&gt; Number of retired breweries: <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@retired_breweries</span>.count </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span> &lt;/<span class="pl-ent">p</span>&gt;

<span class="pl-pse">&lt;%=</span><span class="pl-s1"> render <span class="pl-s"><span class="pl-pds">'</span>list<span class="pl-pds">'</span></span>, <span class="pl-c1">breweries:</span> <span class="pl-smi">@retired_breweries</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>

&lt;<span class="pl-ent">br</span>&gt;

<span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>New Brewery<span class="pl-pds">'</span></span>, new_brewery_path, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span>  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
</pre></div>

<p>The page template for breweries is fancy now!</p>

<blockquote>
<h2>
<a id="user-content-tehtävä-5-6-kahden-tehtävän-arvoinen" class="anchor" href="#teht%C3%A4v%C3%A4-5-6-kahden-teht%C3%A4v%C3%A4n-arvoinen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercises 5 – 6 (this equals two exercises)</h2>

<p>Your Ratings page is somehow boring now. Instead of the ratings, modify it to show:</p>

<ul>
<li>The three best beers and breweries based on the average rating scores</li>
<li>The three users who have made most ratings</li>
<li>The five last ratings which were made.</li>
</ul>

<p><strong>Hints:</strong>
Implement a scope <code>:recent</code> to the class <code>Rating</code>, returning the last five ratings. You find more information on the database request required by scope at <a href="http://guides.rubyonrails.org/active_record_querying.html">http://guides.rubyonrails.org/active_record_querying.html</a>, see order and limit. Try to make the request from the console first!</p>

<p>The scope for the best beer and brewery, and the one for the most enthusiastic raters won't be so simple to make, because they have to find the objects that to return at database level, and they would require complex SQL.</p>

<p>Instead of the scopes, you can make class-level methods (or static method, to tell it in Java's words) for the classes <code>Brewery</code>, <code>Beer</code>, and <code>User</code>, so that the controller will have access to them. For instance, the brewery method could be something like this:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Brewery</span>
 <span class="pl-c"># ...</span>

 <span class="pl-k">def</span> <span class="pl-en">self.top</span>(<span class="pl-smi">n</span>)
   sorted_by_rating_in_desc_order <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.all.sort_by{ |<span class="pl-smi">b</span>| <span class="pl-k">-</span>(b.average_rating<span class="pl-k">||</span><span class="pl-c1">0</span>) }
   <span class="pl-c"># palauta listalta parhaat n kappaletta</span>
   <span class="pl-c"># miten? ks. http://www.ruby-doc.org/core-2.1.0/Array.html</span>
 <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>The method is used from the controller as shown below:</p>

<div class="highlight highlight-ruby"><pre> <span class="pl-smi">@top_breweries</span> <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.top <span class="pl-c1">3</span></pre></div>

<p>Attention: beers, styles and breweries <code>top</code> methods are actually made of copy-paste, and using the modules would allow to define a code only in one place. Once you have done all the week exercises, you can try to clean your code!</p>

<p><strong>Do not copy-paste the views code, but use partials when needed instead.</strong></p>

<h2>
<a id="user-content-tehtävä-7" class="anchor" href="#teht%C3%A4v%C3%A4-7" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävä 7</h2>

<p>Also add the three best beer styles to the page</p>
</blockquote>

<p>After the exercises, the exercises page may look like it follows:</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-4.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-4.png" alt="kuva" style="max-width:100%;"></a></p>

<p>This can be useful to design your page: <a href="http://getbootstrap.com/css/#grid-nesting">http://getbootstrap.com/css/#grid-nesting</a></p>

<h2>
<a id="user-content-näyttöjen-koodin-siistiminen-helpereillä" class="anchor" href="#n%C3%A4ytt%C3%B6jen-koodin-siistiminen-helpereill%C3%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Polishing your code with helpers</h2>

<p>In week 3 we added the <code>current_user</code> method to the class <code>ApplicationController</code> and we said it was a so called helper method</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">ApplicationController<span class="pl-e"> &lt; ActionController::Base</span></span>
  <span class="pl-c"># ...</span>
  helper_method <span class="pl-c1">:current_user</span>

 <span class="pl-k">end</span></pre></div>

<p>Both controllers and views can use the method to check the identity of users who have signed in. Because the method is defined in the class <code>ApplicationController</code> it is available for all controllers. Being definied as helper method, it is available for views too.</p>

<p>Applications often need auxiliary methods (which are called helper methods in Rails) only for view templates. In such cases, they shouldn't be place in the class <code>ApplicationController</code> but in the modules in <em>app/helpers/</em>. If auxiliary methods are supposed to be used in more than one view, the correct place for them is <code>application_helper</code>. Instead, if the auxiliary methods are for the pages which depend on only one controller, they should be defined into the helper module corresponding to the controller.</p>

<p>You'll notice that your views have some redundant parts of code. For instance, the show.html.erb templates for beer, style, and brewery all contain very similar code, which creates the links for editing and deleting:</p>

<div class="highlight highlight-erb"><pre><span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-k">if</span> current_user </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>Edit<span class="pl-pds">'</span></span>, edit_beer_path(<span class="pl-smi">@beer</span>), <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>

  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">'</span>Delete<span class="pl-pds">'</span></span>, <span class="pl-smi">@beer</span>, <span class="pl-c1">method:</span> <span class="pl-c1">:delete</span>, <span class="pl-c1">data:</span> { <span class="pl-c1">confirm:</span> <span class="pl-s"><span class="pl-pds">'</span>Are you sure?<span class="pl-pds">'</span></span> }, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-danger<span class="pl-pds">"</span></span>  </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>Separate them in their own helpers, into the module application_helper.rb</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">module</span> <span class="pl-en">ApplicationHelper</span>
  <span class="pl-k">def</span> <span class="pl-en">edit_and_destroy_buttons</span>(<span class="pl-smi">item</span>)
    <span class="pl-k">unless</span> current_user.nil?
      edit <span class="pl-k">=</span> link_to(<span class="pl-s"><span class="pl-pds">'</span>Edit<span class="pl-pds">'</span></span>, url_for([<span class="pl-c1">:edit</span>, item]), <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span>)
      del <span class="pl-k">=</span> link_to(<span class="pl-s"><span class="pl-pds">'</span>Destroy<span class="pl-pds">'</span></span>, item, <span class="pl-c1">method:</span> <span class="pl-c1">:delete</span>,
                    <span class="pl-c1">data:</span> {<span class="pl-c1">confirm:</span> <span class="pl-s"><span class="pl-pds">'</span>Are you sure?<span class="pl-pds">'</span></span> }, <span class="pl-c1">class:</span><span class="pl-s"><span class="pl-pds">"</span>btn btn-danger<span class="pl-pds">"</span></span>)
      raw(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pse">#{</span><span class="pl-s1">edit</span><span class="pl-pse"><span class="pl-s1">}</span></span> <span class="pl-pse">#{</span><span class="pl-s1">del</span><span class="pl-pse"><span class="pl-s1">}</span></span><span class="pl-pds">"</span></span>)
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>

<span class="pl-k">end</span></pre></div>

<p>The method creates two HTML link elements thanks to link_to and returns both the links "raw" ( <a href="http://apidock.com/rails/ActionView/Helpers/RawOutputHelper/raw">http://apidock.com/rails/ActionView/Helpers/RawOutputHelper/raw</a>), which basically means HTML code, which can embed in the page.</p>

<p>The buttons are added to the beer style pages as below:</p>

<div class="highlight highlight-erb"><pre>&lt;<span class="pl-ent">h2</span>&gt;
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@style</span>.name </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">h2</span>&gt;

&lt;<span class="pl-ent">quote</span>&gt;
  <span class="pl-pse">&lt;%=</span><span class="pl-s1"> <span class="pl-smi">@style</span>.description </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
&lt;/<span class="pl-ent">quote</span>&gt;

...

<span class="pl-pse">&lt;%=</span><span class="pl-s1"> edit_and_destroy_buttons(<span class="pl-smi">@style</span>) </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>The view template really looks much better now.</p>

<p>It would also be possible to separate the buttons code in their own partial, and it is a matter of taste which is the best solution here, whether a helper method or a partial.</p>

<blockquote>
<h2>
<a id="user-content-tehtävä-8" class="anchor" href="#teht%C3%A4v%C3%A4-8" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävä 8</h2>

<p>Most of the pages show the average rating value. Average values are Decimal types, so sometimes they may print with too much precition even. Define an auxiliary method <code>round(param)</code> to render the average value of ratings. The medhod should always print its parameter with only <code>one</code> decimal digit precition, and make use of this halper method in the view templates (or at least in some of them).</p>

<p>You can also use the Rails method <code>number_with_precision</code> in your helper, see <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html#method-i-number_with_precision">http://api.rubyonrails.org/classes/ActionView/Helpers/NumberHelper.html#method-i-number_with_precision</a></p>
</blockquote>

<h2>
<a id="user-content-reitti-panimon-statuksen-muuttamiselle" class="anchor" href="#reitti-panimon-statuksen-muuttamiselle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route to change a brewery status</h2>

<p>A second back, breweries were added the information about their activity and they were given the possibility to change their activity status from the brewery information editing form. It is quite unrealistic, but think that breweries could stop for some time and start again their activity. In such case, editing the activity status from the brewry information editing form would be a bit cumbersome. In such cases, it would be easier if the list with all breweries had a button to change their status with a click. You could implement this kind of button by embedding a suitable form for each breweries in the list. You want to choose another solution this time, though. In addition to Rails six default routes, add the new route <code>toggle_activity</code> to the breweries, so that you will be able edit the brewery status with the help of the HTTP POST calls made to this route.</p>

<p>Make the following fix to the file routes.rb as Tehdään tiedostoon routes.rb seuraava muutos panimon osalta:</p>

<div class="highlight highlight-ruby"><pre>  resources <span class="pl-c1">:breweries</span> <span class="pl-k">do</span>
    post <span class="pl-s"><span class="pl-pds">'</span>toggle_activity<span class="pl-pds">'</span></span>, <span class="pl-c1">on:</span> <span class="pl-c1">:member</span>
  <span class="pl-k">end</span></pre></div>

<p>If you now run <code>rake routes</code>, you'll see the new route which appeared for brewery:</p>

<div class="highlight highlight-ruby"><pre>toggle_activity_brewery <span class="pl-c1">POST</span>   <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-c1">:id</span><span class="pl-k">/</span>toggle_activity(.<span class="pl-c1">:format</span>) breweries<span class="pl-c">#toggle_activity</span>
              breweries <span class="pl-c1">GET</span>    <span class="pl-k">/</span>breweries(.<span class="pl-c1">:format</span>)                     breweries<span class="pl-c">#index</span>
                        <span class="pl-c1">POST</span>   <span class="pl-k">/</span>breweries(.<span class="pl-c1">:format</span>)                     breweries<span class="pl-c">#create</span>
            new_brewery <span class="pl-c1">GET</span>    <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-k">new</span>(.<span class="pl-c1">:format</span>)                 breweries<span class="pl-c">#new</span>
           edit_brewery <span class="pl-c1">GET</span>    <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-c1">:id</span><span class="pl-k">/</span>edit(.<span class="pl-c1">:format</span>)            breweries<span class="pl-c">#edit</span>
                brewery <span class="pl-c1">GET</span>    <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-c1">:id</span>(.<span class="pl-c1">:format</span>)                 breweries<span class="pl-c">#show</span>
                        <span class="pl-c1">PUT</span>    <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-c1">:id</span>(.<span class="pl-c1">:format</span>)                 breweries<span class="pl-c">#update</span>
                        <span class="pl-c1">DELETE</span> <span class="pl-k">/</span>breweries<span class="pl-k">/</span><span class="pl-c1">:id</span>(.<span class="pl-c1">:format</span>)                 breweries<span class="pl-c">#destroy</span></pre></div>

<p>You want to add the activity status change functionality to each brewery page. So the following to the brewery page app/views/breweries/show.html.erb:</p>

<div class="highlight highlight-erb"><pre><span class="pl-pse">&lt;%=</span><span class="pl-s1"> link_to <span class="pl-s"><span class="pl-pds">"</span>change activity<span class="pl-pds">"</span></span>, toggle_activity_brewery_path(<span class="pl-smi">@brewery</span>.id), <span class="pl-c1">method:</span> <span class="pl-c1">:post</span>, <span class="pl-c1">class:</span> <span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>

<p>When you click on the button now, the browser will make an HTTP POST request for the address /breweries/:id/toggle_activity, where ID field is the ID of the brewery you clicked on. Rails routing mechnism tries to call a breweries controller <code>toggle_activity</code> method which does not exist, so this results in an error message. The method can be implement like this:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">toggle_activity</span>
    brewery <span class="pl-k">=</span> <span class="pl-c1">Brewery</span>.find(params[<span class="pl-c1">:id</span>])
    brewery.update_attribute <span class="pl-c1">:active</span>, (<span class="pl-k">not</span> brewery.active)

    new_status <span class="pl-k">=</span> brewery.active? <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">"</span>active<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>retired<span class="pl-pds">"</span></span>

    redirect_to <span class="pl-c1">:back</span>, <span class="pl-c1">notice:</span><span class="pl-s"><span class="pl-pds">"</span>brewery activity status changed to <span class="pl-pse">#{</span><span class="pl-s1">new_status</span><span class="pl-pse"><span class="pl-s1">}</span></span><span class="pl-pds">"</span></span>
  <span class="pl-k">end</span></pre></div>

<p>Implementing this functionality was easy, but does it make sence to add <code>toggle_activity</code> in first place? According the RESTful ideology, it would be more orthodox to use a form to do this, through a PUT request for the path breweries/:id. In any case, you sohuld avoid situations, where a resource status is change through GET requests, and therefore you only defined the path toggle_activity for POST requests.</p>

<p>More about custom routes at
<a href="http://guides.rubyonrails.org/routing.html#adding-more-restful-actions">http://guides.rubyonrails.org/routing.html#adding-more-restful-actions</a></p>

<h2>
<a id="user-content-admin-käyttäjä-ja-pääsynhallintaa" class="anchor" href="#admin-k%C3%A4ytt%C3%A4j%C3%A4-ja-p%C3%A4%C3%A4synhallintaa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Admin user and access management</h2>

<blockquote>
<h2>
<a id="user-content-tehtävä-9" class="anchor" href="#teht%C3%A4v%C3%A4-9" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävä 9</h2>

<p>Anyone who is signed-in can delete breweries, beers, and beer clubs, so far. Exent the system so that a part of the users are administrators, and delete operations are restricted to them alone.</p>

<ul>
<li>Create a new boolean field <code>admin</code> for the USer module. The field helps to indicate the users who have admin rights to the system.</li>
<li>It's enough that admins can be defined only from console.</li>
<li>Make breweries, beers, beer clubs, and styles deletion possible only for aministrators.</li>
</ul>

<p><strong>Attention:</strong> because of password validation reasons, turning a user into admin will not be possible from console if the password field has no value:</p>

<div class="highlight highlight-ruby"><pre>irb(main):<span class="pl-c1">001</span>:<span class="pl-c1">0</span><span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">User</span>.first
irb(main):<span class="pl-c1">002</span>:<span class="pl-c1">0</span><span class="pl-k">&gt;</span> u.admin <span class="pl-k">=</span> <span class="pl-c1">true</span>
irb(main):<span class="pl-c1">003</span>:<span class="pl-c1">0</span><span class="pl-k">&gt;</span> u.save
  (<span class="pl-c1">0</span>.1ms)  rollback transaction
=&gt; <span class="pl-c1">false</span></pre></div>

<p>Editing the value of singular attributes is still possible byepassing the validation with the method <code>update_attr</code>:</p>

<div class="highlight highlight-ruby"><pre>irb(main):<span class="pl-c1">005</span>:<span class="pl-c1">0</span><span class="pl-k">&gt;</span> u.update_attribute(<span class="pl-c1">:admin</span>, <span class="pl-c1">true</span>)</pre></div>

<p><strong>ATTENTION:</strong> you'd better use a <a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/blob/master/web/viikko4.md#kirjautuneiden-toiminnot">before filter</a> when you do this</p>

<h2>
<a id="user-content-tehtävä-10-11-kahden-tehtävän-arvoinen" class="anchor" href="#teht%C3%A4v%C3%A4-10-11-kahden-teht%C3%A4v%C3%A4n-arvoinen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercises 10 – 11 (it's worth of two points)</h2>

<p>Implement such functionality to let administrators freeze user names. Freezing can happen with a button that only administrators see on a user's page. Frozen users can not sign in the system. When they try to sign in, the application should tell that their user name has been frozen, and they should get in touch with admins. Administrators should be able to reactivate frozen user names.</p>

<p><strong>ATTENTION:</strong> do not try to define an attribute called <code>frozen</code>, which is a forbidden attribute name!</p>

<p>You may implement this functionality following the pictures below</p>
</blockquote>

<p>The administrator can freeze a user name from the user's page</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1c.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1c.png" alt="kuva" style="max-width:100%;"></a></p>

<p>The administrator can see the frozen user names from the users view</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1b.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1b.png" alt="kuva" style="max-width:100%;"></a></p>

<p>If a user name is frozen, they won't be able to sign in</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1a.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1a.png" alt="kuva" style="max-width:100%;"></a></p>

<p>The administrator can reactivate frozen user names from the user's page</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1d.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w6-1d.png" alt="kuva" style="max-width:100%;"></a></p>

<h2>
<a id="user-content-monimutkaisempi-pääsynhallinta" class="anchor" href="#monimutkaisempi-p%C3%A4%C3%A4synhallinta" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced authorization</h2>

<p>If your application needs a more diverse authorization, you may want to manage it with the help of the <em>cancan</em> gem, see <a href="https://github.com/CanCanCommunity/cancancan">https://github.com/CanCanCommunity/cancancan</a> and
<a href="http://railscasts.com/episodes/192-authorization-with-cancan">http://railscasts.com/episodes/192-authorization-with-cancan</a></p>

<p>The Rails cast page is old, and you had better take a look at the Github page of the project. Rails casts provide you with brilliant insights on various topics, so even though they may not be updated with all details any more, you may want to go through them in any case.</p>

<h2>
<a id="user-content-rails-sovellusten-tietoturvasta" class="anchor" href="#rails-sovellusten-tietoturvasta" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rails applications information security</h2>

<p>We haven't said anything about Rails applications information security, so far. It's time to go into the topic now. Rails guides provide a brilliant overview on the most common data security threats for Web application and how you can prepare for them on Rails.</p>

<blockquote>
<h2>
<a id="user-content-tehtävät-12-14-kolmen-tehtävän-arvoinen" class="anchor" href="#teht%C3%A4v%C3%A4t-12-14-kolmen-teht%C3%A4v%C3%A4n-arvoinen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercises 12 – 14 (it is worth three points)</h2>

<p>Read <a href="http://guides.rubyonrails.org/security.html">http://guides.rubyonrails.org/security.html</a></p>

<p>The text is long but the topic is relevant. If you want to optimize your time, leave behind sections 4, 5 and 7.4 – 7.8.</p>

<p>You are done with the exercises once you know the following topics</p>

<ul>
<li>SQL injection</li>
<li>CSRF</li>
<li>XSS</li>
<li>smart use of sessions</li>
</ul>

<p>You had better read also the following links, as far as information security is concerned:</p>

<ul>
<li><a href="http://guides.rubyonrails.org/action_controller_overview.html#force-https-protocol">http://guides.rubyonrails.org/action_controller_overview.html#force-https-protocol</a></li>
<li><a href="http://guides.rubyonrails.org/action_controller_overview.html#log-filtering">http://guides.rubyonrails.org/action_controller_overview.html#log-filtering</a></li>
</ul>
</blockquote>

<p>The documents above fail to stress that Rails <em>sanitates</em> (that is, escapes all the script and html tags) by default the input that is rendered on pages, so for instance if you try to input the javascript chunk <code> &lt;script&gt;alert('Evil XSS attack');&lt;/script&gt;</code> to describe the beer style, the code won't be executed, buy it will be rendered on the page 'as text':</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w5-7.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w5-7.png" alt="kuva" style="max-width:100%;"></a></p>

<p>If you take a look at the page source code, you'll notice that Rails has switched &lt; and &gt; signs of the HTML tags with the corresponding printing characters, where the input changes into normal text when it comes to the browser:</p>

<div class="highlight highlight-ruby"><pre> <span class="pl-k">&amp;</span>lt;script<span class="pl-k">&amp;</span>gt;alert(<span class="pl-k">&amp;</span><span class="pl-c">#39;Evil XSS attack&amp;#39;);&amp;lt;/script&amp;gt;</span></pre></div>

<p>The default sanitation can be 'disconnected' by making an explicit request with the help of the method <code>raw</code>, so that the contents are rendered on the page as they are. If you changed in the following the way the style description is rendered</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">&lt;</span>p<span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span><span class="pl-k">%=</span> raw(<span class="pl-smi">@style</span>.description) <span class="pl-s"><span class="pl-pds">%&gt;</span></span>
<span class="pl-s">&lt;/p<span class="pl-pds">&gt;</span></span></pre></div>

<p>the javascript code is executed while it is rendered:</p>

<p><a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w5-8.png" target="_blank"><img src="https://github.com/mluukkai/WebPalvelinohjelmointi2015/raw/master/images/ratebeer-w5-8.png" alt="kuva" style="max-width:100%;"></a></p>

<p>More info at <a href="http://www.railsdispatch.com/posts/security">http://www.railsdispatch.com/posts/security</a> and <a href="http://railscasts.com/episodes/204-xss-protection-in-rails-3">http://railscasts.com/episodes/204-xss-protection-in-rails-3</a></p>

<h2>
<a id="user-content-metaohjelmointia-mielipanimoiden-ja-tyylin-refaktorointi" class="anchor" href="#metaohjelmointia-mielipanimoiden-ja-tyylin-refaktorointi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Metaohjelmointia: mielipanimoiden ja tyylin refaktorointi</h2>

<p>In the exercises 3 and 4 of week 4 (see <a href="https://github.com/mluukkai/WebPalvelinohjelmointi2015/blob/master/web/viikko4.md#teht%C3%A4v%C3%A4-3">https://github.com/mluukkai/WebPalvelinohjelmointi2015/blob/master/web/viikko4.md#teht%C3%A4v%C3%A4-3</a>) you implemented the methods to find out a person's favourite brewery and beer style. The following is a straight solution to implement the methods <code>favorite_style</code> and <code>favorite_brewery</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">User</span>
  <span class="pl-c"># ...</span>

  <span class="pl-k">def</span> <span class="pl-en">favorite_brewery</span>
    <span class="pl-k">return</span> <span class="pl-c1">nil</span> <span class="pl-k">if</span> ratings.empty?
    brewery_ratings <span class="pl-k">=</span> rated_breweries.inject([]) <span class="pl-k">do </span>|<span class="pl-smi">ratings</span>, <span class="pl-smi">brewery</span>|
      ratings <span class="pl-k">&lt;&lt;</span> {
        <span class="pl-c1">brewery:</span> brewery,
        <span class="pl-c1">rating:</span> rating_of_brewery(brewery) }
    <span class="pl-k">end</span>

    brewery_ratings.sort_by { |<span class="pl-smi">brewery</span>| brewery[<span class="pl-c1">:rating</span>] }.last[<span class="pl-c1">:brewery</span>]
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">favorite_style</span>
    <span class="pl-k">return</span> <span class="pl-c1">nil</span> <span class="pl-k">if</span> ratings.empty?
    style_ratings <span class="pl-k">=</span> rated_styles.inject([]) <span class="pl-k">do </span>|<span class="pl-smi">ratings</span>, <span class="pl-smi">style</span>|
      ratings <span class="pl-k">&lt;&lt;</span> {
        <span class="pl-c1">style:</span> style,
        <span class="pl-c1">rating:</span> rating_of_style(style) }
    <span class="pl-k">end</span>

    style_ratings.sort_by { |<span class="pl-smi">style</span>| style[<span class="pl-c1">:rating</span>] }.last[<span class="pl-c1">:style</span>]
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">rated_breweries</span>
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.brewery }.uniq
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">rated_styles</span>
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.style }.uniq
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">rating_of_brewery</span>(<span class="pl-smi">brewery</span>)
    ratings_of_brewery <span class="pl-k">=</span> ratings.select <span class="pl-k">do </span>|<span class="pl-smi">r</span>|
      r.beer.brewery <span class="pl-k">==</span> brewery
    <span class="pl-k">end</span>
    ratings_of_brewery.map(<span class="pl-k">&amp;</span><span class="pl-c1">:score</span>).sum <span class="pl-k">/</span> ratings_of_brewery.count
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">rating_of_style</span>(<span class="pl-smi">style</span>)
    ratings_of_style <span class="pl-k">=</span> ratings.select <span class="pl-k">do </span>|<span class="pl-smi">r</span>|
      r.beer.style <span class="pl-k">==</span> style
    <span class="pl-k">end</span>
    ratings_of_style.map(<span class="pl-k">&amp;</span><span class="pl-c1">:score</span>).sum <span class="pl-k">/</span> ratings_of_style.count
  <span class="pl-k">end</span></pre></div>

<p>Take a look at the method you can use to find out the best breweries. You have two auxiliary methods. The user's rated breweries (that is, the breweries where a user has rated at least one beer) can be accessed in the following way (see <a href="http://www.google.com">http://www.google.com</a> if you don't know the idea behind the map command):</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">rated_breweries</span>
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.brewery }.uniq
  <span class="pl-k">end</span></pre></div>

<p>Another auxiliary method finds out the average value of a particular brewery (see the methods select and map, and check <a href="http://www.google.com">http://www.google.com</a> if you need):</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">rating_of_brewery</span>(<span class="pl-smi">brewery</span>)
    ratings_of_brewery <span class="pl-k">=</span> ratings.select <span class="pl-k">do </span>|<span class="pl-smi">r</span>|
      r.beer.brewery <span class="pl-k">==</span> brewery
    <span class="pl-k">end</span>
    ratings_of_brewery.map(<span class="pl-k">&amp;</span><span class="pl-c1">:score</span>).sum <span class="pl-k">/</span> ratings_of_brewery.count
  <span class="pl-k">end</span></pre></div>

<p>The method to find the best brewery goes through all breweries first and it finds out the average value of their ratings. The result is a table like <code> [ { brewery: 'Koff', rating:10}, {brewery: 'Stadinpanimo', 27 }, {brewery:'Schlenkerla', rating:35}, {brewery:Karjala, rating:18}]</code> (the table does not contain brewery names but brewery objects, actually). The table is sorted against the value of <code>rating</code>. The method returns the first brewery of the last item of the sorted table, in our example the Schlenkerla object.</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">favorite_brewery</span>
    <span class="pl-k">return</span> <span class="pl-c1">nil</span> <span class="pl-k">if</span> ratings.empty?

    brewery_ratings <span class="pl-k">=</span> rated_breweries.inject([]) <span class="pl-k">do </span>|<span class="pl-smi">ratings</span>, <span class="pl-smi">brewery</span>|
      ratings <span class="pl-k">&lt;&lt;</span> {
        <span class="pl-c1">brewery:</span> brewery,
        <span class="pl-c1">rating:</span> rating_of_brewery(brewery) }
    <span class="pl-k">end</span>

    brewery_ratings.sort_by { |<span class="pl-smi">brewery</span>| brewery[<span class="pl-c1">:rating</span>] }.last[<span class="pl-c1">:name</span>]
  <span class="pl-k">end</span></pre></div>

<p>The inject command which creates the table <code>brewery_ratings</code> is nothing but a compact way to write this:</p>

<div class="highlight highlight-ruby"><pre>  brewery_ratings <span class="pl-k">=</span> []

  rated_breweries.each <span class="pl-k">do </span>|<span class="pl-smi">brewery</span>|
    object <span class="pl-k">=</span> {
      <span class="pl-c1">brewery:</span> brewery,
      <span class="pl-c1">rating:</span> rating_of_brewery(brewery)
    }
    brewery_ratings <span class="pl-k">&lt;&lt;</span> object
  <span class="pl-k">end</span></pre></div>

<p>Notice that <code>favorite_style</code> works according the <em>exactly</em> same principle, and the method itself as well as the auxiliary methods it makes use of are actually only copy-paste of the code to find the best brewery.</p>

<p>Because our software has a wide range of tests, it's easy to refactor the copy-paste. Have a look at the following auxiliary methods first:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">rated_breweries</span>
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.brewery }.uniq
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">rated_styles</span>
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.style }.uniq
  <span class="pl-k">end</span></pre></div>

<p>The only difference in the methods is with the code chunk of the <code>map</code> method, where the method calls a beer object that belongs to the rating. The method to call can also be given as parameter. In such case, instead of writing an explicit call, the method is called with the help of the <code>send</code> method:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">rated</span>(<span class="pl-smi">category</span>)
    ratings.map{ |<span class="pl-smi">r</span>| r.beer.send(category) }.uniq
  <span class="pl-k">end</span></pre></div>

<p>The method can now be used in the following way:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">037</span> <span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">User</span>.first
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :038 <span class="pl-k">&gt;</span> u.rated <span class="pl-c1">:style</span>
=&gt; [<span class="pl-c">#&lt;Style id: 1, name: "Lager", description: "Similar to the Munich Helles story, many European ...", created_at: "2015-02-07 18:12:03", updated_at: "2015-02-12 13:24:47"&gt; ...]</span>
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :039 <span class="pl-k">&gt;</span> u.rated <span class="pl-c1">:brewery</span>
 =&gt; [<span class="pl-c">#&lt;Brewery id: 1, name: "Koff", year: 1897, created_at: "2015-01-11 14:29:22", updated_at: "2015-02-12 14:02:01", active: true&gt;, #&lt;Brewery id: 4, name: "BrewDog", year: 2007, created_at: "2015-01-17 13:11:51", updated_at: "2015-02-12 14:02:01", active: true&gt;, #&lt;Brewery id: 3, name: "Weihenstephaner", year: 1042, created_at: "2015-01-11 14:29:22", updated_at: "2015-02-12 14:02:01", active: true&gt;, #&lt;Brewery id: 2, name: "Malmgard", year: 2001, created_at: "2015-01-11 14:29:22", updated_at: "2015-02-12 14:07:55", active: true&gt;]</span></pre></div>

<p>You can give a parameter to the method to compute the average value of style and brewery ratings according to category, as before:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">rating_of</span>(<span class="pl-smi">category</span>, <span class="pl-smi">item</span>)
    ratings_of_item <span class="pl-k">=</span> ratings.select <span class="pl-k">do </span>|<span class="pl-smi">r</span>|
      r.beer.send(category) <span class="pl-k">==</span> item
    <span class="pl-k">end</span>
    ratings_of_item.map(<span class="pl-k">&amp;</span><span class="pl-c1">:score</span>).sum <span class="pl-k">/</span> ratings_of_item.count
  <span class="pl-k">end</span></pre></div>

<p>So, first of all it looks for the ratings for the brewery or beer style that was given as parameter. After that, it computes the average value in the normal way.</p>

<p>The method works as espected:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">051</span> <span class="pl-k">&gt;</span> lager <span class="pl-k">=</span> <span class="pl-c1">Style</span>.first
 =&gt; <span class="pl-c">#&lt;Style id: 1, name: "Lager", description: "Similar to the Munich Helles story, many European ..." &gt;</span>
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">052</span> <span class="pl-k">&gt;</span> u.rating_of(<span class="pl-c1">:style</span>, lager)
 =&gt; <span class="pl-c1">18</span></pre></div>

<p>With the new auxiliary methods, you can easily create a method to find out users favourite brewery and favourite style, according to what parameter you give to the method:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">favorite</span>(<span class="pl-smi">category</span>)
    <span class="pl-k">return</span> <span class="pl-c1">nil</span> <span class="pl-k">if</span> ratings.empty?

    category_ratings <span class="pl-k">=</span> rated(category).inject([]) <span class="pl-k">do </span>|<span class="pl-smi">set</span>, <span class="pl-smi">item</span>|
      set <span class="pl-k">&lt;&lt;</span> {
        <span class="pl-c1">item:</span> item,
        <span class="pl-c1">rating:</span> rating_of(category, item) }
    <span class="pl-k">end</span>

    category_ratings.sort_by { |<span class="pl-smi">item</span>| item[<span class="pl-c1">:rating</span>] }.last[<span class="pl-c1">:item</span>]
  <span class="pl-k">end</span></pre></div>

<p>Try out the console:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">063</span> <span class="pl-k">&gt;</span> u.favorite <span class="pl-c1">:brewery</span>
 =&gt; <span class="pl-c">#&lt;Brewery id: 2, name: "Malmgard", year: 2001, created_at: "2015-01-11 14:29:22", updated_at: "2015-02-12 14:07:55", active: true&gt;</span>
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">065</span> <span class="pl-k">&gt;</span> u.favorite <span class="pl-c1">:style</span>
 =&gt; <span class="pl-c">#&lt;Style id: 3, name: "Baltic porter", description: "Porters of the late 1700's were quite strong compa...", created_at: "2015-02-07 18:12:03", updated_at: "2015-02-07 18:24:28"&gt;</span></pre></div>

<p>The methods to find out favourite style and brewery can then be modified so that they will delegate their functionality to new methods:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">favorite_brewery</span>
    favorite <span class="pl-c1">:brewery</span>
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">favorite_style</span>
    favorite <span class="pl-c1">:style</span>
  <span class="pl-k">end</span></pre></div>

<p>In addition to getting rid of the copy-paste, the solution brings along also another benefit. If you define a new "attribute," like colour, you will simultaneously get a method to find the favourite colour:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">favorite_color</span>
    favorite <span class="pl-c1">:color</span>
  <span class="pl-k">end</span></pre></div>

<h2>
<a id="user-content-method_missing" class="anchor" href="#method_missing" aria-hidden="true"><span class="octicon octicon-link"></span></a>method_missing</h2>

<p>In fact, it would aslo be possible to use methods like <code>favorite_style</code> and <code>favorite_brewery</code>  without defining them explicitly.</p>

<p>Comment away all the methods in your code for a second.</p>

<p>If you called an inexistent method of an object (not being defined in the class itself, in the parent classes or in any module contained in its class or parent classes), like</p>

<div class="highlight highlight-ruby"><pre>jD4h4lsgC1drWwIy2O...<span class="pl-s"><span class="pl-pds">"</span>, admin: true, is_frozen: nil&gt;</span>
<span class="pl-s">2.0.0-p451 :069 &gt; u.paras_bisse</span>
<span class="pl-s">NoMethodError: undefined method `paras_bisse' for #&lt;User:0x000001059cb0c0&gt;</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/activemodel-4.1.5/lib/active_model/attribute_methods.rb:435:in `method_missing'</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/activerecord-4.1.5/lib/active_record/attribute_methods.rb:208:in `method_missing'</span>
<span class="pl-s">  from (irb):69</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/railties-4.1.5/lib/rails/commands/console.rb:90:in `start'</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/railties-4.1.5/lib/rails/commands/console.rb:9:in `start'</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/railties-4.1.5/lib/rails/commands/commands_tasks.rb:69:in `console'</span>
<span class="pl-s">2.0.0-p451 :070 &gt;</span></pre></div>

<p>the result is that the Ruby translator calls a method called <code>method_missing</code> of that class, which has an unknown method name as parameter. All Ruby's classes inherit the class <code>Object</code> which defines the method <code>method_missing</code>. Classes may need to overwrite this method and get "methods" which are not existent, but that work as normal methods as far as the caller knows.</p>

<p>Rails uses <code>method_missing</code> internally in many situations. You can not overwrite it straight, you will have to delegate the <code>method_missing</code> calls to the parent class unless you want to handle them yourself.</p>

<p>Have a try and define the following <code>method_missing</code> for the class <code>User</code>:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">method_missing</span>(<span class="pl-smi">method_name</span>, <span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">&amp;</span><span class="pl-smi">block</span>)
    puts <span class="pl-s"><span class="pl-pds">"</span>nonexisting method <span class="pl-pse">#{</span><span class="pl-s1">method_name</span><span class="pl-pse"><span class="pl-s1">}</span></span> was called with parameters: <span class="pl-pse">#{</span><span class="pl-s1">args</span><span class="pl-pse"><span class="pl-s1">}</span></span><span class="pl-pds">"</span></span>
    <span class="pl-k">return</span> <span class="pl-k">super</span>
  <span class="pl-k">end</span></pre></div>

<p>And see what happens:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">072</span> <span class="pl-k">&gt;</span> u.paras_bisse
nonexisting method paras_bisse was called with <span class="pl-c1">parameters:</span> []
<span class="pl-c1">NoMethodError:</span> undefined method <span class="pl-s"><span class="pl-pds">`</span>paras_bisse' for #&lt;User:0x000001016af8e0&gt;</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/activemodel-4.1.5/lib/active_model/attribute_methods.rb:435:in <span class="pl-pds">`</span></span>method_missing<span class="pl-s"><span class="pl-pds">'</span></span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/activerecord-4.1.5/lib/active_record/attribute_methods.rb:208:in `method_missing<span class="pl-pds">'</span></span>
  from <span class="pl-k">/</span><span class="pl-c1">Users</span><span class="pl-k">/</span>mluukkai<span class="pl-k">/</span>kurssirepot<span class="pl-k">/</span>ratebeer<span class="pl-k">/</span>app<span class="pl-k">/</span>models<span class="pl-k">/</span>user.<span class="pl-c1">rb:</span><span class="pl-c1">30</span><span class="pl-c1">:in</span> <span class="pl-s"><span class="pl-pds">`</span>method_missing'</span>
<span class="pl-s">2.0.0-p451 :073 &gt;</span></pre></div>

<p>As you see above, <code>method_missing</code> has been executed. You can overwrite it in the following way:</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">method_missing</span>(<span class="pl-smi">method_name</span>, <span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">&amp;</span><span class="pl-smi">block</span>)
    <span class="pl-k">if</span> method_name <span class="pl-k">=~</span> <span class="pl-sr"><span class="pl-pds">/</span>^favorite_<span class="pl-pds">/</span></span>
      category <span class="pl-k">=</span> method_name[<span class="pl-c1">9</span>..<span class="pl-k">-</span><span class="pl-c1">1</span>].to_sym
      <span class="pl-v">self</span>.favorite category
    <span class="pl-k">else</span>
      <span class="pl-k">return</span> <span class="pl-k">super</span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span></pre></div>

<p>All the method calls that start with <code>favorite_</code> and that are unknown will be handled in the following way: the part after the underscore will be separated and the obect will be called the method <code>favorite</code> so that the part after the underscore stands for the parameter defining the category.</p>

<p>Now the methods <code>favorite_brewery</code> and <code>favorite_style</code> "exist" and work properly:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">076</span> <span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">User</span>.first
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :<span class="pl-c1">077</span> <span class="pl-k">&gt;</span> u.favorite_brewery.name
 =&gt; <span class="pl-s"><span class="pl-pds">"</span>Malmgard<span class="pl-pds">"</span></span>
<span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :078 <span class="pl-k">&gt;</span> u.favorite_style.name
  =&gt; <span class="pl-s"><span class="pl-pds">"</span>Baltic porter<span class="pl-pds">"</span></span></pre></div>

<p>The problem now is that whatever method that starts with favorite_ "would work", but it would cause an error which is far from being optimal.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">2.0</span>.<span class="pl-c1">0</span><span class="pl-k">-</span>p451 :079 <span class="pl-k">&gt;</span> u.favorite_movie
<span class="pl-c1">NoMethodError:</span> undefined method <span class="pl-s"><span class="pl-pds">`</span>movie' for #&lt;Beer:0x00000105a18690&gt;</span>
<span class="pl-s">  from /Users/mluukkai/.rvm/gems/ruby-2.0.0-p451/gems/activemodel-4.1.5/lib/active_model/attribute_methods.rb:435:in <span class="pl-pds">`</span></span>method_missing<span class="pl-s"><span class="pl-pds">'</span></span></pre></div>

<p>Ruby provides various opportunities to define what <code>favorite_</code> methods are accepted. You could implement for instance this very Ruby-like way to define it:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">User<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  <span class="pl-k">include</span> <span class="pl-c1">RatingAverage</span>

  favorite_available_by <span class="pl-c1">:style</span>, <span class="pl-c1">:brewery</span>

  <span class="pl-c"># ...</span>
<span class="pl-k">end</span></pre></div>

<p>This is not the time to go too much deeper into it. This would be useful only if favorite_ methods could be used in other calsses too.</p>

<p>You can end here the implementation with method_missing and go back to the versions that had been commented away at the beginning of the chapter.</p>

<p>If the things that have been explained in this chapter are interesting for you, you can continue with the following:</p>

<ul>
<li><a href="http://rubymonk.com/learning/books/5-metaprogramming-ruby-ascent">http://rubymonk.com/learning/books/5-metaprogramming-ruby-ascent</a></li>
<li><a href="http://rubymonk.com/learning/books/2-metaprogramming-ruby">http://rubymonk.com/learning/books/2-metaprogramming-ruby</a></li>
<li><a href="https://github.com/sathish316/metaprogramming_koans">https://github.com/sathish316/metaprogramming_koans</a></li>
<li>also the book <a href="http://www.amazon.com/Eloquent-Ruby-Addison-Wesley-Professional-Series/dp/0321584104">Eloquent Ruby</a> is a good reference on the topic</li>
</ul>

<h2>
<a id="user-content-tehtävien-palautus" class="anchor" href="#teht%C3%A4vien-palautus" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tehtävien palautus</h2>

<p>Commit all the changes that you have done and push the code in Github. Deploy also the newest version into Heroku.</p>

<p>You should mark that you have returned the exercises at <a href="http://wadrorstats2015.herokuapp.com/">http://wadrorstats2015.herokuapp.com/</a></p>
</article>
  </div>

</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" action="" class="js-jump-to-line-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="btn">Go</button>
</form></div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
        <li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
      <li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>

    <a href="https://github.com" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
</a>
    <ul class="site-footer-links">
      <li>&copy; 2015 <span title="0.03953s from github-fe129-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
    </ul>
  </div>
</div>


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents" placeholder=""></textarea>
      <div class="suggester-container">
        <div class="suggester fullscreen-suggester js-suggester js-navigation-container"></div>
      </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    

    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-5c08de317e4054ec200d36d3b1361ddd3cb30c05c9070a9d72862ee28ab1d7f9.js"></script>
      <script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github/index-bfb27c17548d6c05bbe36a476673446098f04766b4a2ce445e2ae9d5374622ff.js"></script>
      
      

  </body>
</html>

